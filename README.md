# ChronoDocs: A Temporal Custodian for Your Documentation

ChronoDocs is a command-line tool designed to act as a **temporal custodian** for documentation systems, especially those generated by autonomous AI agents. It watches for file changes, automatically enforces a chronological naming convention, and generates human-readable change logs.

This tool was built to address the common problem of AI agents creating documentation with inconsistent or missing numeric prefixes, making it difficult for humans to follow the agent's exploration and implementation process. By handling file naming and ordering automatically, ChronoDocs reduces agent complexity and provides a clear, stable, and auditable record of work.

## Key Features

- **Automatic Chronological Naming**: Watches a directory and automatically renames files to `00-name.md`, `01-another.md`, etc., based on their creation time.
- **Stable Creation Index**: Maintains a persistent index (`.creation_index.json`) to ensure that the chronological order is preserved across sessions and file renames.
- **Content-Aware Change Tracking**: Uses content hashing to track when a file's content has *actually* changed, not just when its modification time has been updated.
- **Human-Readable Change Logs**: Generates Markdown change logs (`change_log.md`) that provide a clear overview of what changed, when, and what the current git status of each file is.
- **Continuous & Autonomous**: Runs in the background as a long-running process, automatically managing your documentation without manual intervention.
- **Configurable**: Uses a simple `.chronodocs.yml` file to define watched directories, ignore patterns, and other settings.

## Installation

ChronoDocs is a Python command-line tool. To install it, you will need Python 3.10+ and a tool like `pip` or `uv`.

1.  **Clone the repository:**
    ```bash
    git clone <repository-url>
    cd chronodocs
    ```

2.  **Install the dependencies:**
    It is recommended to use a virtual environment.

    ```bash
    # Create and activate a virtual environment
    python -m venv .venv
    source .venv/bin/activate

    # Install the tool and its dependencies
    pip install -e .
    ```
    *(Note: For development, you can install testing dependencies with `pip install -e '.[dev]'`)*

## Configuration

ChronoDocs is configured via a `.chronodocs.yml` file in the root of your repository. Here is an example configuration:

```yaml
# .chronodocs.yml

# Phase directory template; {phase} is interpolated at runtime
phase_dir_template: ".devcontext/progress/{phase}"

# Directories/files to watch (for the root sentinel watcher)
watch_paths:
- "src/"
- "docs/"
- ".devcontext/progress/"

# Patterns to ignore (for all watchers)
ignore_patterns:
- ".git/"
- "node_modules/"
- ".venv/"
- "__pycache__/"
- ".creation_index.json"
- ".update_index.json"
- "change_log.md"
- "*.tmp"

# Debounce windows (in milliseconds) to wait after a file change
debounce:
  phase: 2000 # For the phase watcher
  root: 3000  # For the root watcher

# Command to run when the root watcher detects changes
make_command: "chronodocs report --phase my_current_phase --output .devcontext/progress/my_current_phase/change_log.md"

# Default settings for the 'report' command
report:
  group_by: "updated_day"
  extensions:
  - ".md"
  - ".py"
```

## CLI Usage

ChronoDocs provides a set of commands to manage your documentation.

### `chronodocs reconcile`

Manually triggers the reconciliation process for a phase directory. This will scan the directory, update the indices, and rename files according to their creation order.

```bash
chronodocs reconcile --phase <phase_name>

# Example:
chronodocs reconcile --phase feature-development

# You can also perform a dry run to see what would be renamed:
chronodocs reconcile --phase feature-development --dry-run
```

### `chronodocs report`

Generates a Markdown change log for a specified phase.

```bash
chronodocs report --phase <phase_name>

# Example:
chronodocs report --phase feature-development

# You can write the output to a file:
chronodocs report --phase feature-development --output docs/changelog.md
```

### `chronodocs watch`

Starts a long-running process that watches a phase directory for changes and automatically runs the reconciler. This is the primary command for autonomous documentation management.

```bash
chronodocs watch --phase <phase_name>

# Example:
chronodocs watch --phase feature-development
# Press Ctrl+C to stop the watcher.
```

### `chronodocs sentinel`

Starts a long-running "sentinel" process that watches the entire repository (as configured in `watch_paths`) for changes. When a change is detected, it runs the `make_command` from your configuration file. This is useful for automatically regenerating the change log.

```bash
chronodocs sentinel
# Press Ctrl+C to stop the watcher.
```

## Known Issues

-   **Root Watcher Ignore Logic**: The `sentinel` (root watcher) does not currently respect the `ignore_patterns` correctly. It may trigger on files that are intended to be ignored (e.g., `change_log.md`), which can lead to feedback loops. The test for this functionality is currently disabled. This is the most critical known issue and is a priority for a future fix.

## How It Works

ChronoDocs uses a combination of file system watching, git integration, and persistent JSON indices to achieve its functionality.

-   **`.creation_index.json`**: This file maps a stable identifier for each file (inode on POSIX, filename on Windows) to its creation time. This ensures that even if a file is renamed, its original creation order is preserved.
-   **`.update_index.json`**: This file stores a content hash (SHA256) for each file. This allows ChronoDocs to know when a file's *content* has actually changed, which is more reliable than just looking at the file's modification timestamp.
-   **`watchdog` library**: The underlying file system watching is handled by the `watchdog` library, which provides a cross-platform API for monitoring file system events.
-   **Git Integration**: ChronoDocs uses `git` to enrich the change log reports with the status of each file (e.g., staged, modified, committed).

## Contributing

Contributions are welcome! If you would like to help improve ChronoDocs, please feel free to submit a pull request or open an issue. The most immediate area for improvement is the known issue with the root watcher's ignore logic.
